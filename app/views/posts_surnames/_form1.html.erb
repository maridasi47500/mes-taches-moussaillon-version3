  <%=text_field_tag :search, "", id: "searchA"%>
  <select id="search1"></select>
  <div id="ps"></div>

<%=form_with model: post, data:{id: post.id},html: {id:'formsurname',onsubmit: "myphotonow(this);return false;"} do |f|%>
  <%=hidden_field_tag :ajax, value: "true"%>
<button type="button" id="myRecordingBtn">let us make the character talk</button>
<div id="myRecordingModal" class="recordingmodal">
  <!-- Modal content -->
  <div class="recordingmodal-content">
    <span class="close" onclick="offfa();return false;">&times;</span>
<%=f.collection_radio_buttons(:recordingmylanguage, Language.all, :id, :name,{include_hidden: false}) do |b|%>



  <%=b.label do %>
  <%=b.radio_button %>
<%= render Language.find(b.value)%>
<%end%>
<%end%>
<%=f.collection_radio_buttons(:recordingmyemotion, Emotion.all, :id, :name,{include_hidden: false}) do |b|%>


  <%=b.label do %>
  <%=b.radio_button %>
<%= render Emotion.find(b.value)%>
<%end%>
<%end%>

    <%=select_tag :mytyperecord, options_for_select([['phraseandword','phrases and words'], ['wordandphrase','words and phrases'], ['onlyword','two words'],['onlyphrase','only phrases']].collect {|a,b| [b,a]}), {name: "selectyourrecordform", prompt: "select a form"}%>

    <div id="mylatestam">
      <%=render template: "tasks/nouvelaidememoire", locals: {task: post}%>
    </div>
    <%=label "recordview","tout nouvel aide mémoire"%>
    <%=radio_button_tag "recordview","new"%>

    <%=label "recordview", "créer un aide mémoire à partir d'un autre"%>
    <%=radio_button_tag "recordview","fromother"%>

    <%=label "recordview","écrire la suite d'un aide memoire"%>
    <%=radio_button_tag "recordview","nextone"%>


      <%=button_tag "tout nouvel aide mémoire", type: "button", onclick: "$.ajax({url: '/record/'+selectyourrecordform.value+'?postssurnameid=#{post.id}&myview='+recordview.value+'&listeam='+tousmesaidememoires.value,success:function(data){$('.myfields').html(data);}});return false;"%>
    <div class="myfields">

  </div>
    <button type="button" onclick="sendmyspecialaudiofiles();return false;">créer ce memory card</button>




</div>
</div>


<%#=render partial: "formrecord/recordrecordingtablesurname", locals: {mylabel: "record the surname",meaning:"qui le dit?", myfield: "recordmywords1", form: f, modelderails: PostsSurname.new,am:Recording.new,sot:nil}%>
<%#=render partial: "formrecord/recordrecordingtablesurname", locals: {mylabel: "record the text of the speech",meaning:"a propos de qui est ce post", myfield: "recordmyphrasesandwords1", form: f, modelderails: PostsSurname.new,am:Recording.new,sot:nil}%>
                          <div class="field">
  <button type="button" onclick="$.ajax({type:'post',url: '<%=rendermypostssurnames_path%>?'+$('form').serialize(), success: function(data){$('#post_content_fr').val($('#post_content_fr').val()+data);}});"> add this posts_surname to content </button> </div>
                          <h2>Add a content</h2>
                          <div class="field">
        <% PostsSurname.locale_columns(:content).each do |column| %>
  <div class="field">
    <%= f.label column %>
    <%= f.text_area column, class: 'contentpost', onkeydown: "mypersonsubtitle.innerHTML = this.value;" %>

</div>

  <% end %>


                    </div>





<%if params["personids"] && params["personids"].length > 0%>
      <div class="mypeople">

<h2>comme si j'étais <%=render Person.find(params["personids"][0])%></h2>
<%=f.hidden_field :speaklike_id, value: params["personids"][0].to_i%>
          <button onclick='$.ajax({url: "/persondisplay/<%=params["personids"][0]%>",success:function(data){$(".editable_fr").append(data);$("#post_content_fr").val($("#post_content_fr").val()+data);$("#post_content_fr").focus(); }});' id="btn<%=params["personids"][0]%>" type="button">add him/her to content</button>
          <button onclick='$.ajax({url: "/persondisplay/<%=params["personids"][0]%>",success:function(data){$(".editable_fr").append(data);$("#post_my_posts_surnames_attributes_0_content_fr").val($("#post_my_posts_surnames_attributes_0_content_fr").val()+data);$("#post_my_posts_surnames_attributes_0_content_fr").focus(); }});' id="btn<%=params["personids"][0]%>" type="button">add him/her to content of the posts surname</button>
      </div>


      <%else%>
      <div class="mypeople">
      <%= f.label :speaklike_id, "comme si il-elle était-en se prenant pour " %>
      <%= f.collection_radio_buttons(:speaklike_id, Person.where(id:[post.speaklike_id,(@person ? @person.id : nil)]), :id, :name) do |ff| %>
        <%=ff.radio_button%>
<%=render partial: "people/personradiobutton",locals: {personid:ff.value}%>
                            <%end%>
<%=  f.radio_button( "speaklike_id", nil)%><%= f.label "speaklike_id", "personne"%>

      </div>
<%end%>
      <div>
        <%= text_field_tag :cherchonsici, "",onchange:"chercherici(this,chercheici);return false;", id: "cherchonsici",class:"mysearchfieldavatars" %>

      </div>
        <select onchange="selectpeople(this,avat1);return false;" id="chercheici" data-field="speaklike_id"></select>
<div id="avat1"></div>
    <%= f.fields_for :surname,(post.surname||Surname.new) do |surname| %>
      <div>
        <%= surname.label :name, "Surnom/Pseudonym" %>
        <%= surname.text_field :name, required:true %>
      </div>

      <div>
        <%= surname.label :image, "Image for this surname" %>
        <%= surname.file_field :image %>
      </div>
    <%end%>

      <div>
      <%= f.label :fakename, "prétend-il-elle s'appeler ainsi ? " %>
      <%= f.check_box(:fakename)%>
      </div>

      <div class="monetranger">
      <%= f.label :stranger_id, "le personnage qui parle estetranger a cette personne/ne pourrait pas etre lui" %>
      <%= f.collection_radio_buttons(:stranger_id, Person.where(id: post.stranger_id), :id, :name) do |ff| %>
        
        <%=ff.radio_button%><%=render Person.find(ff.value)%><button onclick='$.ajax({url: "/persondisplay/<%=ff.value%>",success:function(data){$(".editable_fr").append(data);$("#post_content_fr").val($("#post_content_fr").val()+data); }});' id="btn<%=ff.value%>" type="button">add him/her to content</button>
                            <%end%>
                                <%=  f.radio_button( "stranger_id", nil)%><%= f.label "stranger_id", "personne"%>

      </div>
      <div>
        <%= label :monetranger, "appeler une personne inconnue/etrangere au locuteur" %>
        <%= text_field_tag :monetranger, nil, id: 'monetranger', class:"mysearchfieldavatars", onchange: "chercherici(this, unetranger);return false;" %>
        <select onchange="selectpeople(this,avat2);return false;" id="unetranger" data-field="stranger_id"></select>
<div id="avat2"></div>



      </div>
      <div class="mondestinataire">
      <%= f.label :destinataire_id, "le message est pour qui-est destiné à qui ?" %>
      <%= f.collection_radio_buttons(:destinataire_id, Person.where(id: post.destinataire_id), :id, :name) do |ff| %>
        
        <%=ff.radio_button%><%=render Person.find(ff.value)%><button onclick='$.ajax({url: "/persondisplay/<%=ff.value%>",success:function(data){$(".editable_fr").append(data);$("#post_content_fr").val($("#post_content_fr").val()+data); }});' id="btn<%=ff.value%>" type="button">add him/her to content</button>
                            <%end%>
                                <%=  f.radio_button( "destinataire_id", nil)%><%= f.label "destinataire_id", "personne"%>

      </div>
    <%= f.fields_for :surnamedestinataire do |surname| %>
      <div>
        <%= surname.label :name, "donnez un surnom au destinataire" %>
        <%= surname.text_field :name %>
      </div>
    <%end%>

      <div>
        <%= label :mondestinataire, "appeler un destinataire" %>
        <%= text_field_tag :mondestinataire, nil, id: 'mondestinataire', class:"mysearchfieldavatars",onchange:"chercherici(this,mondesti);return false;" %>
        <select onchange="selectpeople(this,avat3);return false;" id="mondesti" data-field="destinataire_id"></select>
<div id="avat3"></div>


      </div>
          <div>
        <%= f.label :action_name, "name action this person is doing" %>
        <%= f.text_field :action_name %>
          </div>
                                          <%=f.fields_for :thing do |stuff|%>
                                    <div>
        <%= stuff.label :name, "name for this stuff" %>
        <%= stuff.text_field :name %>
      </div>
      <div>
        <%= stuff.label :image, "load a pic for this stuff" %>
        <%= stuff.file_field :image %>
      </div>
                  
                        <%end%>
                        <h2>Add a place</h2>
                <div class="placessurnamesattributes">
                  <%=radio_button_tag :where1, "", {autocomplete:"off",checked:false},{onchange: "$(p2).toggleClass('vis');$(p1).toggleClass('vis');return false;",id: "addanewplace",class: "btn-check",name:"where"}%>

                          <%=label :where1, "", {class: "btn btn-secondary",for:"addanewplace"} do%>

          select a place
        <%end%>
        <%=radio_button_tag :where2, "", {autocomplete:"off",checked:true},{onchange: "$(p2).toggleClass('vis');$(p1).toggleClass('vis');return false;",name:"where",id: "selectplace",class: "btn-check"}%>

                          <%=label :where2, "", {class: "btn btn-secondary",for:"selectplace"} do%>
          add a new place

        <%end%>

                  <div class="invis vis" id="p1">
                                    <button  type="button" onclick="$.ajax({url:'<%=addaplacetosurnameattribute_path%>',success:function(data){myplace.innerHTML=data;}});return false;">add a new place</button></div>
                  <div class="invis" id="p2">
                                    <%=text_field_tag :myplacename, "",placeholder:"search a place",id:"nameplace"%>
                                    <button id="p3" type="button" onclick="$.ajax({url:'<%=selectaplacetosurnameattribute_path%>?name='+nameplace.value,success:function(data){myplace.innerHTML=data;}});return false;">select a place</button>
                                    <select id="propp3"></select>
                  </div>
                                    <div id="myplace"></div>
    <%= f.fields_for :place do |surname| %>
      <div>
        <%= surname.label :name, "place from where you post a message" %>
        <%= surname.text_field :name %>
      </div>
      <div>
        <%= surname.label :image, "image for this place" %>
        <%= surname.file_field :image %>
        <%= surname.hidden_field :longitude %>
        <%= surname.hidden_field :latitude %>
      </div>
          <div>

                  <%= surname.label :_destroy, "remove this place" %>
          <%= surname.check_box :_destroy %>
      </div>
    <%end%>

                </div>

                        <h2>Add a sailor</h2>
                <div class="field">

                    <div class="allthesailors-list sailorsonlylist"> 
<%if post.person%>
      <%= f.label :person_id, "Sailors " %>
      <%= f.collection_radio_buttons(:person_id, [post.person], :id, :name) do |ff| %>
        <%=ff.radio_button%><%=render Person.find(ff.value)%><button onclick='$.ajax({url: "/persondisplay/<%=ff.value%>",success:function(data){$(".editable_fr").append(data);$("#post_content_fr").val($("#post_content_fr").val()+data); }});' id="btn<%=ff.value%>" type="button">add him/her to content</button>
                            <%end%>
                        <%=  f.radio_button( "person_id", nil)%><%= f.label "person_id", "personne"%>
<%end%>

                    </div>

      </div>
<%if post.profilepic%>
                    <div class=""> 
      <%= f.label :profilepic_id, "Profile pic " %>
      <%= f.collection_radio_buttons(:profilepic_id, [post.profilepic],:id, :name) do |ff| %>
        <%=ff.radio_button%><%=render Profilepicture.find(ff.value)%>                            <%end%>
                        <%=  f.radio_button( "profilepic_id", nil)%><%= f.label "profilepic_id", "no profilepic"%>

                    </div>
<%end%>

      </div>
      <div>
        <%= label :maprofilepic, "chercher un sailor" %>
        <%= text_field_tag :monsailor, nil, id: 'monsailor',class:'mysearchfieldavatars',onchange:"chercherici(this,sailorshere);return false;" %>
        <select onchange="selectpeople(this,avat4);return false;" id="sailorshere" data-field="person_id"></select>
<div id="avat4"></div>


      </div>
<div id="maprofilpic">
<%= f.fields_for :profilepic do |g| %>
<div class="field">
<%=g.label :name, "Add a profile pic for him/her"%>
  <%=g.file_field("name")%>
</div>    
<div class="field">
<%=g.label :nameimage, "What's on the pic?"%>
  <%=g.text_field("nameimage")%>
</div>    

<%end%>
</div>

      <div>
        <%= label :maprofilepic, "chercher une photo de profil" %>
        <%= text_field_tag :maprofilepic, nil, id: 'maphotodeprofil',class:'mysearchfieldavatars' %>
        <%=link_to "chercher des photos de profil", "", onclick: "$.ajax({url: '/posts_surnames/myavatars?fieldname=profilepic_id&classname=Profilepicture&name='+$('#maphotodeprofil').val(),success: function(code) {$(maprofilpic).html(code);console.log(code);}});return false;"%>

      </div>

          <div class="field">
            <%=f.label :photoprofilactuelle, "utiliser la photo de profil actuelle de quelqu'un"%>
            <%=f.collection_select(:photoprofilactuelle, Person.afficherceuxla(@addthosesailors),:id, :name,{:prompt => 'Please select somebody'})%>
          </div>
          <div id="greatpeople">
          </div>


<%= f.submit "ok"%>
<%end%>
<%=content_for :myjs do%>
 // Get the modal
var modal = document.getElementById("myRecordingModal");
// Get the button that opens the modal
var btn = document.getElementById("myRecordingBtn");
// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}
// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}
// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

<%if !post.new_record?%>
function sendmyspecialaudiofiles(){
  var formData = new FormData($(formsurname)[0]);
                          event.preventDefault();
          $.ajax({processData: false,data:formData,
            contentType: false,
            url:'<%=nouvelaidememoire_posts_surname_path(post.id)%>',
type: 'post',success:function(aidememoires){console.log(aidememoires);mylatestam.innerHTML = aidememoires;}});return false;
}
<%end%>
<%end%>

<%=content_for :mylittlecss do%>
.recordingmodal, .recordingmodal1 {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}
/* Modal Content/Box */
.recordingmodal-content, .recordingmodal-content1 {
  background-color: #fefefe;
  margin: 15% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 80%; /* Could be more or less, depending on screen size */
}
/* The Close Button */
.close, .close1 {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}
.close:hover, .close:focus, close1:hover, .close1:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

<%end%>
<%=content_for :myjscode do%>
<script>
function chercherici(field,selectfield){
$.ajax({url: '<%=personjson_albums_path%>?name='+field.value, 
success:function(data){
selectfield.innerHTML="<option></option>";
var value, id;
for (var i=0;i<data.length;i++){
id=data[i].id;
name=data[i].name;
selectfield.innerHTML+="<option value='"+id+"'>"+name+"</option>";
}
}});
};
function selectpeople(field,box){
$.ajax({url: '<%=mypeople_posts_surnames_path%>?field='+field.dataset.field+'&id='+field.value, 
success:function(data){
box.innerHTML+=data;

}});
};
</script>
<% end %>
  <%=content_for :myjscode do%>
  <script>
  $(function(){

    $("#searchA").change(function(){
        var deptid = $(this).val();

        $.ajax({
          url: '<%=mypsa_path%>',
            type: 'post',
            data: {name:deptid},
            dataType: 'json',
            success:function(response){

                var len = response.length;

                $("#search1").empty();
                    $("#search1").append("<option id='nulla' value=''>aucun</option>");
		var id,name;
                for( var i = 0; i<len; i++){
                    id = response[i]['psid'];
                    name = response[i]['myname1'];


                    $("#search1").append("<option id='psa"+id+"' value='"+id+"'>"+name+"</option>");


                }
                    $("#search1").change(function(){
                for( var i = 0; i<len; i++){
                    id = response[i]['psid'];
                    name = response[i]['myname1'];
			if ($(this).val() == id){
                    $.ajax({url: '<%=loadpostsurname_people_path%>?id='+id, success:function(data){ps.innerHTML+=data;}});
			}
            	}
			});
            }
        });
    });
   

});
  </script>
<%end%>

