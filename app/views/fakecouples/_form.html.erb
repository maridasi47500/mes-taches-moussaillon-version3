<%= form_with(model: fakecouple, local: true) do |form| %>
  <% if fakecouple.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(fakecouple.errors.count, "error") %> prohibited this fakecouple from being saved:</h2>

      <ul>
        <% fakecouple.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>



<%if fakecouple.someoneelse.try(:alreadyexist)%>
<%=form.select :someoneelse_id, options_for_select([fakecouple.someoneelse.alreadyexist].collect {|x|[x.person.name+" "+x.otherperson.name,x.id]},fakecouple.someoneelse.alreadyexist.id), {prompt: "please select the two people"}%>
<%else%>

<%=form.fields_for :someoneelse do |firm|%>
  <div class="field">
<div class="mypeople">
      <%= firm.label :person_id, "moussaillon 1" %>
      <%= firm.collection_radio_buttons(:person_id, [fakecouple.someoneelse.try(:person)].select{|x|x.try(:id)}, :id, :name) do |ff| %>
        <%=ff.radio_button%>
<%=render Person.find(ff.value)%>
 <%end%>
      </div>
      <div><%= text_field_tag :cherchonsp, "",onchange:"chercherpeople(this,cherchep);return false;", id: "cherchonsp",class:"mysearchfieldavatars" %></div>
        <select onchange="selectp(this,avatpeople);return false;" id="cherchep" data-field="action_ids"></select>
<div id="avatpeople"></div>
  </div>

  <div class="field">
<div class="mypeople">
      <%= firm.label :otherperson_id, "moussaillon 2" %>
      <%= firm.collection_radio_buttons(:otherperson_id, [fakecouple.otherperson].select{|x|x.try(:id)}, :id, :name) do |ff| %>
        <%=ff.radio_button%>
<%=render Person.find(ff.value)%>
 <%end%>
      </div>
      <div><%= text_field_tag :cherchonsparici, "",onchange:"chercherpeople(this,chercheparla);return false;", id: "cherchonsparici",class:"mysearchfieldavatars" %></div>
        <select onchange="selectpeople(this,avattasks);return false;" id="chercheparla" data-field="action_ids"></select>
<div id="avattasks"></div>
  </div>
<%end%>
<%end%>
  
<%if fakecouple.otherperson.try(:alreadyexist)%>
<%=form.select :otherperson_id, options_for_select([fakecouple.otherperson.alreadyexist].collect {|x|[x.person.name+" "+x.otherperson.name,x.id]},fakecouple.otherperson.alreadyexist.id), {prompt: "please select the two people"}%>
<%else%>

<%=form.fields_for :otherperson do |firm|%>
  <div class="field">
<div class="mypeople">
      <%= firm.label :person_id, "moussaillon 1" %>
      <%= firm.collection_radio_buttons(:person_id, [fakecouple.otherperson.try(:person)].select{|x|x.try(:id)}, :id, :name) do |ff| %>
        <%=ff.radio_button%>
<%=render Person.find(ff.value)%>
 <%end%>
      </div>
      <div><%= text_field_tag :cherchonsp, "",onchange:"chercherpeople(this,cherchep1);return false;", id: "cherchonsp1",class:"mysearchfieldavatars" %></div>
        <select onchange="selectp1(this,avatpeople1);return false;" id="cherchep1" data-field="action_ids"></select>
<div id="avatpeople1"></div>
  </div>

  <div class="field">
<div class="mypeople">
      <%= firm.label :otherperson_id, "moussaillon 2" %>
      <%= firm.collection_radio_buttons(:otherperson_id, [fakecouple.otherperson].select{|x|x.try(:id)}, :id, :name) do |ff| %>
        <%=ff.radio_button%>
<%=render Person.find(ff.value)%>
 <%end%>
      </div>
      <div><%= text_field_tag :cherchonsparici, "",onchange:"chercherpeople(this,chercheparla1);return false;", id: "cherchonsparici1",class:"mysearchfieldavatars" %></div>
        <select onchange="selectpeople1(this,avattasks1);return false;" id="chercheparla1" data-field="action_ids"></select>
<div id="avattasks1"></div>
  </div>
<%end%>
<%end%>
  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>
<%=content_for :myjscode do%>
<script>

function chercherpeople(field,all){
$.ajax({url: '<%=personjson_people_path%>?name='+field.value, 
success:function(data){
all.innerHTML="<option></option>";
var value, id;
for (var i=0;i<data.length;i++){
id=data[i].id;
name=data[i].name;
all.innerHTML+="<option value='"+id+"'>"+name+"</option>";
}
}});
};
function selectp(field,greatpeople){
$.ajax({url: '<%=people_fakecouples_path%>?id='+field.value, 
success:function(data){
greatpeople.innerHTML+=data;
}});
};

function selectpeople(field,greatpeople){
$.ajax({url: '<%=otherpeople_fakecouples_path%>?id='+field.value, 
success:function(data){
greatpeople.innerHTML+=data;
}});
};
function selectp1(field,greatpeople){
$.ajax({url: '<%=people1_fakecouples_path%>?id='+field.value, 
success:function(data){
greatpeople.innerHTML+=data;
}});
};

function selectpeople1(field,greatpeople){
$.ajax({url: '<%=otherpeople1_fakecouples_path%>?id='+field.value, 
success:function(data){
greatpeople.innerHTML+=data;
}});
};
</script>
<%end%>


