<%= form_with(model: linkspouseperson, local: true) do |form| %>
  <% if linkspouseperson.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(linkspouseperson.errors.count, "error") %> prohibited this linkspouseperson from being saved:</h2>

      <ul>
        <% linkspouseperson.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>


<div>
<%=form.label :begindating%>
<%=form.date_select("begindating", order: [:month, :year],start_year: 2000,end_year: Date.today.year, prompt: { month: 'Select month', year: 'Select year' })%>
</div>
<div>
<%=form.label :enddating%>
<%=form.date_select("enddating", order: [:month, :year], start_year: 2000, end_year:Date.today.year, prompt: { month: 'Select month', year: 'Select year' })%>
</div>
<%if linkspouseperson.twoperson.alreadyexist%>
<%=form.select :twoperson_id, options_for_select([linkspouseperson.twoperson.alreadyexist].collect {|x|[x.person.name+" "+x.otherperson.name,x.id]},linkspouseperson.twoperson.alreadyexist.id), {prompt: "please select the two people"}%>
<%else%>

<%=form.fields_for :twoperson do |firm|%>
  <div class="field">
<div class="mypeople">
      <%= firm.label :person_id, "moussaillon 1" %>
      <%= firm.collection_radio_buttons(:person_id, [linkspouseperson.person].select{|x|x}, :id, :name) do |ff| %>
        <%=ff.radio_button%>
<%=render Person.find(ff.value)%>
 <%end%>
      </div>
      <div><%= text_field_tag :cherchonsp, "",onchange:"chercherpeople(this,cherchep);return false;", id: "cherchonsp",class:"mysearchfieldavatars" %></div>
        <select onchange="selectp(this,avatpeople);return false;" id="cherchep" data-field="action_ids"></select>
<div id="avatpeople"></div>
  </div>

  <div class="field">
<div class="mypeople">
      <%= firm.label :otherperson_id, "moussaillon 2" %>
      <%= firm.collection_radio_buttons(:otherperson_id, [linkspouseperson.otherperson].select{|x|x}, :id, :name) do |ff| %>
        <%=ff.radio_button%>
<%=render Person.find(ff.value)%>
 <%end%>
      </div>
      <div><%= text_field_tag :cherchonsparici, "",onchange:"chercherpeople(this,chercheparla);return false;", id: "cherchonsparici",class:"mysearchfieldavatars" %></div>
        <select onchange="selectpeople(this,avattasks);return false;" id="chercheparla" data-field="action_ids"></select>
<div id="avattasks"></div>
  </div>
<%end%>
<%end%>
  <div class="field">
    <%= form.label :spouselink_id, "Relation they have" %>
      <%= form.collection_radio_buttons(:spouselink_id, [linkspouseperson.spouselink].select{|x|x}, :id, :name) %>

  </div>
      <div><%= text_field_tag :cherchonsrel, "",onchange:"chercherrel(this,chercheunerel);return false;", id: "cherchonsrel",class:"mysearchfieldavatars" %></div>
        <select onchange="selectrel(this,rel);return false;" id="chercheunerel" data-field="action_ids"></select>
<div id="rel"></div>
  <div class="field">
<%=render "form/checkboxcolumn", columnname: :content, form: form, fieldname: 'ticket_ids', collec: linkspouseperson.tickets, mesmodele:"tickets"%>
</div>
  <div class="field">
<%=render "form/checkbox", form: form, fieldname: 'otherlinkspouseperson_ids', collec: linkspouseperson.otherlinkspousepeople, mesmodele:"linkspousepeople"%>
</div>
<table>
<%linkspouseperson.coupleevents.each do |e|%>
<%=form.fields_for :coupleevents, e do |f|%>
<tr>
<td>
<%=f.label :date%>
<%=f.date_field :date%>
</td>
  <% Coupleevent.locale_columns(:content).each do |column| %>
<td>
<%=f.label column%>
<%=f.text_area column%>
</td>

<%end%>
<td>
<%=f.hidden_field :user_id, value: current_user.id%>
</td>
</tr>
<%end%>
<%end%>
</table>

  <div class="field">
<%=form.label :myphotos, "photos du couple"%>

<%=form.file_field :myphotos, multiple: true%>
</div>


  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>
<%=content_for :myjscode do%>
<script>

function chercherpeople(field,all){
$.ajax({url: '<%=personjson_people_path%>?name='+field.value, 
success:function(data){
all.innerHTML="<option></option>";
var value, id;
for (var i=0;i<data.length;i++){
id=data[i].id;
name=data[i].name;
all.innerHTML+="<option value='"+id+"'>"+name+"</option>";
}
}});
};
function selectp(field,greatpeople){
$.ajax({url: '<%=people_linkspousepeople_path%>?id='+field.value, 
success:function(data){
greatpeople.innerHTML+=data;
}});
};

function selectpeople(field,greatpeople){
$.ajax({url: '<%=otherpeople_linkspousepeople_path%>?id='+field.value, 
success:function(data){
greatpeople.innerHTML+=data;
}});
};
function chercherrel(field,all){
$.ajax({url: '<%=json_spouselinks_path%>?name='+field.value, 
success:function(data){
all.innerHTML="<option></option>";
var value, id;
for (var i=0;i<data.length;i++){
id=data[i].id;
name=data[i].name_<%=I18n.locale%>;
all.innerHTML+="<option value='"+id+"'>"+name+"</option>";
}
}});
};
function selectrel(field,greatpeople){
$.ajax({url: '<%=links_linkspousepeople_path%>?id='+field.value, 
success:function(data){
greatpeople.innerHTML+=data;
}});
};
</script>
<%end%>
<%=content_for :myjscode do%>
<script>
<%@paths2=[json_tickets_path,json_linkspousepeople_path]%>
<%@paths=[tickets_linkspousepeople_path,otherlinkspousepeople_linkspousepeople_path]%>
<%@nom=['tickets','linkspousepeople']%>
<%=render partial:"form/functionjson", collection: @nom.zip(@paths2, @paths), as: :t%>
</script>
<%end%>

